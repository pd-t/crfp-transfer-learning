schema: '2.0'
stages:
  load:
    cmd: PYTHONPATH="." python3 src/load.py
    deps:
    - path: src/load.py
      hash: md5
      md5: 98cd61d5de1b035a904502cb1f6ddbd4
      size: 1781
    params:
      params.yaml:
        data.remote.s3_bucket: data
        data.remote.s3_endpoint_url: https://storage.s3.mlops.wogra.com
        data.remote.s3_path: dlr/Tapelegedaten2023.zip
        data.seed: 42
        data.select: 5000
    outs:
    - path: data/load.dir
      hash: md5
      md5: 01bc32df75677aa7312c96cb6d2e4bce.dir
      size: 84402887
      nfiles: 3
  prepare:
    cmd: PYTHONPATH="." python src/prepare.py
    deps:
    - path: data/load.dir
      hash: md5
      md5: 2b806b2c55fe2f0091c50191957749a2.dir
      size: 84526599
      nfiles: 10
    - path: src/prepare.py
      md5: f1bda56fc9db37162b9ef1627ce66076
      size: 1157
    outs:
    - path: data/prepare.dir
      hash: md5
      md5: 7948926cf08a227a7a4cc72e0452724d.dir
      size: 10299219
      nfiles: 3
  train:
    cmd: PYTHONPATH="." python src/train.py
    deps:
    - path: data/prepare.dir
      hash: md5
      md5: f7eb99316c3e4c82f7c2113fa1d0e378.dir
      size: 10307635
      nfiles: 7
    - path: src/train.py
      hash: md5
      md5: 3007ee8e496f23fbe8f679883d95587e
      size: 7287
    params:
      params.yaml:
        model.asha.grace_period: 3
        model.asha.max_t: 10
        model.asha.n_trials: 5
        model.asha.reduction_factor: 2
        model.asha.trial_cpus: 1
        model.asha.trial_gpus: 0.5
        model.batch_size: 128
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.eval-test-size: 0.2
        model.gradient_accumulation_steps: 4
        model.hyperparameters.batch_sizes:
        - 16
        - 32
        - 64
        - 128
        model.hyperparameters.learning_rate_max: 0.0001
        model.hyperparameters.learning_rate_min: 1e-06
        model.learning_rate: 5e-05
        model.loading_steps: 10
        model.logging_steps: 10
        model.num_train_epochs: 10
        model.seed: 42
        model.test-size: 0.5
        model.warmup_ratio: 0.1
    outs:
    - path: data/train.dir
      hash: md5
      md5: 50780a853bd977714a9ce1d0e6655086.dir
      size: 2059866630
      nfiles: 56
  evaluate:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/train.dir
      hash: md5
      md5: 7d00ab8843f7cf74e1e98f5a47d9bc79.dir
      size: 37073683992
      nfiles: 327
    - path: src/eval.py
      md5: 77b984401b2a3527ccc6e786f03c820b
      size: 1323
    outs:
    - path: accuracy.json
      hash: md5
      md5: 4be7d31ec2cde52bbf9389cd0d6b6c5e
      size: 970
    - path: loss.json
      hash: md5
      md5: f8f0746552998458c56c6e2ba9f9cbdc
      size: 935
    - path: metrics.json
      hash: md5
      md5: d379b637ad8b23ebb877878060219f4c
      size: 81
