schema: '2.0'
stages:
  load:
    cmd: PYTHONPATH="." python3 src/load.py
    deps:
    - path: src/load.py
      hash: md5
      md5: 5058b4d14cb22b1fe1cb148f6c7e9113
      size: 1824
    params:
      params.yaml:
        data.remote.s3_bucket: data
        data.remote.s3_endpoint_url: https://storage.s3.mlops.wogra.com
        data.remote.s3_path: dlr/Tapelegedaten2023.zip
        data.seed: 42
        data.select: Complete
    outs:
    - path: data/load.dir
      hash: md5
      md5: bb4f1cbb1eb0ea481f06678900e5e90e.dir
      size: 1072629957
      nfiles: 9
  prepare:
    cmd: PYTHONPATH="." python src/prepare.py
    deps:
    - path: data/load.dir
      hash: md5
      md5: bb4f1cbb1eb0ea481f06678900e5e90e.dir
      size: 1072629957
      nfiles: 9
    - path: src/prepare.py
      hash: md5
      md5: eaf22a0f9cdaf73057a90102c5e75801
      size: 1699
    - path: src/shared/data.py
      hash: md5
      md5: ace017e5b2950187c30244f6b791ae62
      size: 1250
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    params:
      params.yaml:
        data.logging_file: split.json
        data.seed: 42
        data.test-size: 0.3
        data.train-size: 0.9
    outs:
    - path: data/prepare.dir
      hash: md5
      md5: 5d98a46439beba5acb781aada9b0f4f2.dir
      size: 1098076705
      nfiles: 18
    - path: data/split.json
      hash: md5
      md5: d4bf9a88ce2d94171394faf56ce018d6
      size: 871
  train:
    cmd: PYTHONPATH="." python src/train.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: 800cb89d2db0792b721bf0381e920942.dir
      size: 76385
      nfiles: 24
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    - path: src/train.py
      hash: md5
      md5: 2af613a73e5765a772bb44eb5e7976f1
      size: 4577
    params:
      params.yaml:
        data.seed: 42
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.labels_per_category:
        - 100
        model.logging_file: models.json
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 1
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: data/models.json
      hash: md5
      md5: 61a3cd7cdd802f9145ee17a058475c28
      size: 438
    - path: data/train.dir
      hash: md5
      md5: cdb27273313f04977c823266c4af02c7.dir
      size: 1969759
      nfiles: 2
  evaluate:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: 5d8f36b427ecbff26cf5121d3a4c3395.dir
      size: 297599
      nfiles: 45
    - path: src/eval.py
      hash: md5
      md5: 985f1f91a8660f31dc86bf75937ab6fe
      size: 3087
    outs:
    - path: accuracy.json
      hash: md5
      md5: 4be7d31ec2cde52bbf9389cd0d6b6c5e
      size: 970
    - path: loss.json
      hash: md5
      md5: eb6dc966007703a9f6aa949b22acffc2
      size: 936
    - path: metrics.json
      hash: md5
      md5: d379b637ad8b23ebb877878060219f4c
      size: 81
  search:
    cmd: PYTHONPATH="." python src/search.py
    deps:
    - path: data/prepare.dir
      hash: md5
      md5: 5d98a46439beba5acb781aada9b0f4f2.dir
      size: 1098076705
      nfiles: 18
    - path: src/search.py
      hash: md5
      md5: f4cff80d50ef16513a533c61e8bec84c
      size: 2750
    - path: src/shared/data.py
      hash: md5
      md5: ace017e5b2950187c30244f6b791ae62
      size: 1250
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    params:
      params.yaml:
        asha.grace_period: 3
        asha.max_t: 10
        asha.n_trials: 3
        asha.reduction_factor: 2
        asha.trial_cpus: 1
        asha.trial_gpus: 0.5
        data.seed: 42
        hyperparameters.batch_sizes:
        - 16
        - 32
        - 64
        - 128
        hyperparameters.labels_per_category: 256
        hyperparameters.learning_rates:
        - 1e-06
        - 0.0001
        model.checkpoint: google/vit-base-patch16-224-in21k
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 1
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: data/search.dir
      hash: md5
      md5: 800cb89d2db0792b721bf0381e920942.dir
      size: 76385
      nfiles: 24
  eval:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/train.dir
      hash: md5
      md5: cdb27273313f04977c823266c4af02c7.dir
      size: 1969759
      nfiles: 2
    - path: src/eval.py
      hash: md5
      md5: 43e19ad05314436e97e985ef690f7455
      size: 3859
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    params:
      params.yaml:
        cml.logging_file: cml.json
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.labels_per_category:
        - 100
        model.logging_file: models.json
    outs:
    - path: data/cml.json
      hash: md5
      md5: dfd3b9a0bd024135a401ca542d9c1c85
      size: 156
    - path: data/eval.dir
      hash: md5
      md5: 58895b55b97582f3dcdba49e02c07cfc.dir
      size: 65171
      nfiles: 4
    - path: plots/accuracies.png
      hash: md5
      md5: fd33d8240e211cfef70c5ba7d6c2e2f3
      size: 14770
    - path: plots/losses.png
      hash: md5
      md5: 113633f958e2febb62b8f64689c4dc1a
      size: 11778
