schema: '2.0'
stages:
  load:
    cmd: PYTHONPATH="." python3 src/load.py
    deps:
    - path: src/load.py
      md5: a4f79b82458c6ec571686c88bc1c5cc8
      size: 1755
    params:
      params.yaml:
        data.remote.s3_bucket: data
        data.remote.s3_endpoint_url: https://storage.s3.mlops.wogra.com
        data.remote.s3_path: dlr/Tapelegedaten2023.zip
    outs:
    - path: data/load.dir
      md5: 5766a5f3e24b300fe9bbc10ef1325ee8.dir
      size: 27040487
      nfiles: 10
  prepare:
    cmd: PYTHONPATH="." python src/prepare.py
    deps:
    - path: data/load.dir
      md5: 5766a5f3e24b300fe9bbc10ef1325ee8.dir
      size: 27040487
      nfiles: 10
    - path: src/prepare.py
      md5: f1bda56fc9db37162b9ef1627ce66076
      size: 1157
    outs:
    - path: data/prepare.dir
      md5: ec202076507657588ca0f04402bac739.dir
      size: 2199979
      nfiles: 7
  train:
    cmd: PYTHONPATH="." python src/train.py
    deps:
    - path: data/prepare.dir
      md5: ec202076507657588ca0f04402bac739.dir
      size: 2199979
      nfiles: 7
    - path: src/train.py
      md5: ad2c5fe4fcf1b9cca42486f7565d57df
      size: 4874
    params:
      params.yaml:
        model.batch_size: 256
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.eval-test-size: 0.2
        model.gradient_accumulation_steps: 4
        model.learning_rate: 5e-05
        model.loading_steps: 10
        model.logging_steps: 10
        model.num_train_epochs: 1
        model.seed: 42
        model.test-size: 0.5
        model.warmup_ratio: 0.1
    outs:
    - path: data/train.dir
      md5: 71e6b95c006360ba99ec0463492707ea.dir
      size: 345477950
      nfiles: 16
  evaluate:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/train.dir
      md5: 71e6b95c006360ba99ec0463492707ea.dir
      size: 345477950
      nfiles: 16
    - path: src/eval.py
      md5: 034f95daa49c0c805f0b689fb3cfe868
      size: 1595
    outs:
    - path: data/accuracy.json
      md5: 976b93bb46ae991c73bf829b8fedc836
      size: 81
    - path: data/cm.json
      md5: 01638cb904ac7a008eab021eb777b933
      size: 1359
    - path: data/loss.json
      md5: f5f4bc21121a4e3d829ae77224061671
      size: 77
    - path: data/metrics.json
      md5: 4249cde052f60d950610df47c33ca95c
      size: 80
