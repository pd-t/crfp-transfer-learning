schema: '2.0'
stages:
  load:
    cmd: PYTHONPATH="." python3 src/load.py
    deps:
    - path: src/load.py
      hash: md5
      md5: 5058b4d14cb22b1fe1cb148f6c7e9113
      size: 1824
    params:
      params.yaml:
        data.remote.s3_bucket: data
        data.remote.s3_endpoint_url: https://storage.s3.mlops.wogra.com
        data.remote.s3_path: dlr/Tapelegedaten2023.zip
        data.seed: 42
        data.select: Complete
    outs:
    - path: data/load.dir
      hash: md5
      md5: 22cf1c666ff5bfeb9539ff9837ea0cbb.dir
      size: 1073962413
      nfiles: 20
  prepare:
    cmd: PYTHONPATH="." python src/prepare.py
    deps:
    - path: data/load.dir
      hash: md5
      md5: 22cf1c666ff5bfeb9539ff9837ea0cbb.dir
      size: 1073962413
      nfiles: 20
    - path: src/prepare.py
      hash: md5
      md5: be40b9fcc978d4f2554c4645765690b4
      size: 1639
    - path: src/shared/data.py
      hash: md5
      md5: ace017e5b2950187c30244f6b791ae62
      size: 1250
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    params:
      params.yaml:
        data.logging_file: data.json
        data.seed: 42
        data.test-size: 0.3
        data.train-size: 0.9
    outs:
    - path: data.json
      hash: md5
      md5: d4bf9a88ce2d94171394faf56ce018d6
      size: 871
    - path: data/prepare.dir
      hash: md5
      md5: 6253adefff464aab0038684aecd01764.dir
      size: 1098076705
      nfiles: 18
  train:
    cmd: PYTHONPATH="." python src/train.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: e4399e0099d6ed5b7c6a109b22712c9b.dir
      size: 541675
      nfiles: 73
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    - path: src/train.py
      hash: md5
      md5: 4c1d73d920f23890bcd6b1cdfaacc943
      size: 4537
    params:
      params.yaml:
        data.seed: 42
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.labels_per_category:
        - 300
        - 200
        - 100
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 10
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: data/train.dir
      hash: md5
      md5: 7a23c3f8102cc4a8dcd997fa0c55ea13.dir
      size: 5916685
      nfiles: 6
    - path: models.json
      hash: md5
      md5: 23835faecd75d3ed7642f3a41d6914eb
      size: 862
  evaluate:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: 5d8f36b427ecbff26cf5121d3a4c3395.dir
      size: 297599
      nfiles: 45
    - path: src/eval.py
      hash: md5
      md5: 985f1f91a8660f31dc86bf75937ab6fe
      size: 3087
    outs:
    - path: accuracy.json
      hash: md5
      md5: 4be7d31ec2cde52bbf9389cd0d6b6c5e
      size: 970
    - path: loss.json
      hash: md5
      md5: eb6dc966007703a9f6aa949b22acffc2
      size: 936
    - path: metrics.json
      hash: md5
      md5: d379b637ad8b23ebb877878060219f4c
      size: 81
  search:
    cmd: PYTHONPATH="." python src/search.py
    deps:
    - path: data/prepare.dir
      hash: md5
      md5: 6253adefff464aab0038684aecd01764.dir
      size: 1098076705
      nfiles: 18
    - path: src/search.py
      hash: md5
      md5: f4cff80d50ef16513a533c61e8bec84c
      size: 2750
    - path: src/shared/data.py
      hash: md5
      md5: ace017e5b2950187c30244f6b791ae62
      size: 1250
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    params:
      params.yaml:
        asha.grace_period: 3
        asha.max_t: 10
        asha.n_trials: 10
        asha.reduction_factor: 2
        asha.trial_cpus: 1
        asha.trial_gpus: 0.5
        data.seed: 42
        hyperparameters.batch_sizes:
        - 16
        - 32
        - 64
        - 128
        hyperparameters.labels_per_category: 256
        hyperparameters.learning_rates:
        - 1e-06
        - 0.0001
        model.checkpoint: google/vit-base-patch16-224-in21k
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 10
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: data/search.dir
      hash: md5
      md5: e4399e0099d6ed5b7c6a109b22712c9b.dir
      size: 541675
      nfiles: 73
  eval:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/train.dir
      hash: md5
      md5: 7a23c3f8102cc4a8dcd997fa0c55ea13.dir
      size: 5916685
      nfiles: 6
    - path: src/eval.py
      hash: md5
      md5: 4fda881806a9870587fa92c141695eb6
      size: 3042
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    outs:
    - path: accuracies.png
      hash: md5
      md5: 8675a31baad915a17ab8bb6337272c72
      size: 30997
    - path: data/eval.dir
      hash: md5
      md5: 977f8392ab95c1da56b480a2b2c2ae7d.dir
      size: 224519
      nfiles: 12
    - path: losses.png
      hash: md5
      md5: 6c2b81d1b41b3c0ab4902d2ce714dc55
      size: 29030
