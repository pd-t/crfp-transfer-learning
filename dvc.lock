schema: '2.0'
stages:
  load:
    cmd: PYTHONPATH="." python3 src/load.py
    deps:
    - path: src/load.py
      md5: 3c3d38c3c44a3c1b6acd842b2ca25a6b
      size: 1773
    params:
      params.yaml:
        data.remote.s3_bucket: data
        data.remote.s3_endpoint_url: https://storage.s3.mlops.wogra.com
        data.remote.s3_path: dlr/Tapelegedaten2023.zip
        data.seed: 42
        data.select: 5000
    outs:
    - path: data/load.dir
      hash: md5
      md5: 5942db6e62cf9566cb72ab552ccaf0b3.dir
      size: 84402887
      nfiles: 3
  prepare:
    cmd: PYTHONPATH="." python src/prepare.py
    deps:
    - path: data/load.dir
      hash: md5
      md5: 8e0afab9debb1035f95907bffcb8bd29.dir
      size: 84526599
      nfiles: 10
    - path: src/prepare.py
      md5: f1bda56fc9db37162b9ef1627ce66076
      size: 1157
    outs:
    - path: data/prepare.dir
      hash: md5
      md5: f0dd21da9d77cef96de3625b05e31ee4.dir
      size: 10299219
      nfiles: 3
  train:
    cmd: PYTHONPATH="." python src/train.py
    deps:
    - path: data/prepare.dir
      hash: md5
      md5: 76a8b323393c9495b38375e02191d729.dir
      size: 10307635
      nfiles: 7
    - path: src/train.py
      md5: f1c62bec554edc216c568ec50e4c6472
      size: 4740
    params:
      params.yaml:
        model.batch_size: 256
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.eval-test-size: 0.2
        model.gradient_accumulation_steps: 4
        model.learning_rate: 5e-05
        model.loading_steps: 10
        model.logging_steps: 10
        model.num_train_epochs: 10
        model.seed: 42
        model.test-size: 0.5
        model.warmup_ratio: 0.1
    outs:
    - path: data/train.dir
      hash: md5
      md5: 9d573bd7111ef8af0809e8d3ae09b13a.dir
      size: 9529
      nfiles: 2
  evaluate:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/train.dir
      hash: md5
      md5: 9d573bd7111ef8af0809e8d3ae09b13a.dir
      size: 9529
      nfiles: 2
    - path: src/eval.py
      md5: 77b984401b2a3527ccc6e786f03c820b
      size: 1323
    outs:
    - path: accuracy.json
      hash: md5
      md5: b80aafac48b7e3a1f07e718f0bfa8ba0
      size: 974
    - path: loss.json
      hash: md5
      md5: 3303d76403a7d0d51710f535e9c9bf28
      size: 932
    - path: metrics.json
      hash: md5
      md5: 24b45095ff548117da2eeb6367d5d718
      size: 79
