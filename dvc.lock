schema: '2.0'
stages:
  load:
    cmd: PYTHONPATH="." python3 src/load.py
    deps:
    - path: src/load.py
      hash: md5
      md5: 5058b4d14cb22b1fe1cb148f6c7e9113
      size: 1824
    params:
      params.yaml:
        data.remote.s3_bucket: data
        data.remote.s3_endpoint_url: https://storage.s3.mlops.wogra.com
        data.remote.s3_path: dlr/Tapelegedaten2023.zip
        data.seed: 42
        data.select: Complete
    outs:
    - path: data/load.dir
      hash: md5
      md5: 22cf1c666ff5bfeb9539ff9837ea0cbb.dir
      size: 1073962413
      nfiles: 20
  prepare:
    cmd: PYTHONPATH="." python src/prepare.py
    deps:
    - path: data/load.dir
      hash: md5
      md5: 22cf1c666ff5bfeb9539ff9837ea0cbb.dir
      size: 1073962413
      nfiles: 20
    - path: src/prepare.py
      hash: md5
      md5: 1dba9598335684ebabcb95feee321306
      size: 1671
    - path: src/shared/data.py
      hash: md5
      md5: dbc74e7d866940984e936c0122c5031e
      size: 1154
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    params:
      params.yaml:
        data.logging_file: data.json
        data.seed: 42
        data.test-size: 0.3
        data.train-size: 0.9
    outs:
    - path: data.json
      hash: md5
      md5: d4bf9a88ce2d94171394faf56ce018d6
      size: 871
    - path: data/prepare.dir
      hash: md5
      md5: e483f2b895d0c2e6908f5534809ae5ef.dir
      size: 1098455465
      nfiles: 19
  train:
    cmd: PYTHONPATH="." python src/train.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: 53d69870ee169b58dec400081d95e41e.dir
      size: 3151912
      nfiles: 353
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    - path: src/train.py
      hash: md5
      md5: a816e72f362189c819ae4e0b4c0a12fa
      size: 4471
    params:
      params.yaml:
        data.seed: 42
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.labels_per_category:
        - 900
        - 600
        - 300
        - 100
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 30
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: data/train.dir
      hash: md5
      md5: ae16af24aaa78415375769f8eafcefea.dir
      size: 7911768
      nfiles: 8
    - path: models.json
      hash: md5
      md5: e4b79e8faee0e5b2c8a22d29d1f73d5e
      size: 926
  evaluate:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: 5d8f36b427ecbff26cf5121d3a4c3395.dir
      size: 297599
      nfiles: 45
    - path: src/eval.py
      hash: md5
      md5: 985f1f91a8660f31dc86bf75937ab6fe
      size: 3087
    outs:
    - path: accuracy.json
      hash: md5
      md5: 4be7d31ec2cde52bbf9389cd0d6b6c5e
      size: 970
    - path: loss.json
      hash: md5
      md5: eb6dc966007703a9f6aa949b22acffc2
      size: 936
    - path: metrics.json
      hash: md5
      md5: d379b637ad8b23ebb877878060219f4c
      size: 81
  search:
    cmd: PYTHONPATH="." python src/search.py
    deps:
    - path: data/prepare.dir
      hash: md5
      md5: e483f2b895d0c2e6908f5534809ae5ef.dir
      size: 1098455465
      nfiles: 19
    - path: src/search.py
      hash: md5
      md5: f053b99315f35a16b2484604fbb4500b
      size: 2734
    - path: src/shared/data.py
      hash: md5
      md5: dbc74e7d866940984e936c0122c5031e
      size: 1154
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    params:
      params.yaml:
        asha.grace_period: 3
        asha.max_t: 30
        asha.n_trials: 50
        asha.reduction_factor: 2
        asha.trial_cpus: 1
        asha.trial_gpus: 0.5
        data.seed: 42
        hyperparameters.batch_sizes:
        - 16
        - 32
        - 64
        - 128
        hyperparameters.labels_per_category: 256
        hyperparameters.learning_rates:
        - 1e-06
        - 0.0001
        model.checkpoint: google/vit-base-patch16-224-in21k
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 30
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: data/search.dir
      hash: md5
      md5: 53d69870ee169b58dec400081d95e41e.dir
      size: 3151912
      nfiles: 353
  eval:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/train.dir
      hash: md5
      md5: ae16af24aaa78415375769f8eafcefea.dir
      size: 7911768
      nfiles: 8
    - path: src/eval.py
      hash: md5
      md5: 4a63cd2f2187ca0045d31e32ed103951
      size: 2287
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    outs:
    - path: data/eval.dir
      hash: md5
      md5: 2431cf860bfdffa056443458a0ce6fa0.dir
      size: 248124
      nfiles: 16
