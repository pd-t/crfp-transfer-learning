schema: '2.0'
stages:
  load:
    cmd: PYTHONPATH="." python3 src/load.py
    deps:
    - path: src/load.py
      hash: md5
      md5: 5058b4d14cb22b1fe1cb148f6c7e9113
      size: 1824
    params:
      params.yaml:
        data.remote.s3_bucket: data
        data.remote.s3_endpoint_url: https://storage.s3.mlops.wogra.com
        data.remote.s3_path: dlr/Tapelegedaten2023.zip
        data.seed: 42
        data.select: Complete
    outs:
    - path: data/load.dir
      hash: md5
      md5: 4cd25c4988c25b5daac345c2b1a0149a.dir
      size: 1073072484
      nfiles: 9
  prepare:
    cmd: PYTHONPATH="." python src/prepare.py
    deps:
    - path: data/load.dir
      hash: md5
      md5: 4cd25c4988c25b5daac345c2b1a0149a.dir
      size: 1073072484
      nfiles: 9
    - path: src/prepare.py
      hash: md5
      md5: d43e25e639cf76faf01dc546177333bc
      size: 2025
    - path: src/shared/data.py
      hash: md5
      md5: d4099da48508ad4d447232c6e8fa559f
      size: 1467
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    params:
      params.yaml:
        data.logging_file: data.json
        data.seed: 42
        data.test-size: 0.3
        data.train-size: 0.9
    outs:
    - path: data/data.json
      hash: md5
      md5: aeae181fc66c054a39a370d9a20ba10c
      size: 431
    - path: data/prepare.dir
      hash: md5
      md5: 47469b49a8ea5ef2a2b4f020e79b66d2.dir
      size: 1099404286
      nfiles: 18
  train:
    cmd: PYTHONPATH="." python src/train.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: fc1f31b4829c7609c49783dc3afec1c7.dir
      size: 2008903
      nfiles: 213
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    - path: src/train.py
      hash: md5
      md5: 627d566359b0f38adce59399e1ee16f2
      size: 3953
    params:
      params.yaml:
        data.seed: 42
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.labels_per_category:
        - 500
        - 400
        - 300
        - 200
        - 100
        model.logging_file: model.json
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 30
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: data/model.json
      hash: md5
      md5: 2ea36ec7705b81891b5e11158dd0cffa
      size: 209
    - path: data/train.dir
      hash: md5
      md5: 2605efac850289ea7d465fbbccfddf1b.dir
      size: 9885861
      nfiles: 10
  evaluate:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: 5d8f36b427ecbff26cf5121d3a4c3395.dir
      size: 297599
      nfiles: 45
    - path: src/eval.py
      hash: md5
      md5: 985f1f91a8660f31dc86bf75937ab6fe
      size: 3087
    outs:
    - path: accuracy.json
      hash: md5
      md5: 4be7d31ec2cde52bbf9389cd0d6b6c5e
      size: 970
    - path: loss.json
      hash: md5
      md5: eb6dc966007703a9f6aa949b22acffc2
      size: 936
    - path: metrics.json
      hash: md5
      md5: d379b637ad8b23ebb877878060219f4c
      size: 81
  search:
    cmd: PYTHONPATH="." python src/search.py
    deps:
    - path: data/prepare.dir
      hash: md5
      md5: 47469b49a8ea5ef2a2b4f020e79b66d2.dir
      size: 1099404286
      nfiles: 18
    - path: src/search.py
      hash: md5
      md5: 3568fc85a0e8e2abba3d3b88460e9944
      size: 2834
    - path: src/shared/data.py
      hash: md5
      md5: d4099da48508ad4d447232c6e8fa559f
      size: 1467
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    params:
      params.yaml:
        asha.grace_period: 3
        asha.max_t: 21
        asha.n_trials: 30
        asha.reduction_factor: 2
        asha.trial_cpus: 1
        asha.trial_gpus: 0.5
        data.seed: 42
        hyperparameters.batch_sizes:
        - 16
        - 32
        - 64
        - 128
        hyperparameters.labels_per_category: 256
        hyperparameters.learning_rates:
        - 1e-06
        - 0.0001
        model.checkpoint: google/vit-base-patch16-224-in21k
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 30
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: data/search.dir
      hash: md5
      md5: fc1f31b4829c7609c49783dc3afec1c7.dir
      size: 2008903
      nfiles: 213
  eval:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/train.dir
      hash: md5
      md5: 2605efac850289ea7d465fbbccfddf1b.dir
      size: 9885861
      nfiles: 10
    - path: src/eval.py
      hash: md5
      md5: faf34c8450bd9e01b227bb8b54c8aa1d
      size: 4520
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    params:
      params.yaml:
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.labels_per_category:
        - 500
        - 400
        - 300
        - 200
        - 100
        model.logging_file: model.json
        report.logging_file: report.json
    outs:
    - path: data/eval.dir
      hash: md5
      md5: fbe9beba82d498db1d2dc7f62aa054e7.dir
      size: 380149
      nfiles: 20
    - path: data/report.json
      hash: md5
      md5: d7add085fb4fb3cc9b65c2466a5cc781
      size: 200
    - path: plots/data.png
      hash: md5
      md5: 2dd08937ca7bacf1372d10cb38999cc9
      size: 69643
    - path: plots/eval_accuracy.png
      hash: md5
      md5: 34ef8ea35cd670afa8991a91b900bc15
      size: 38946
    - path: plots/eval_loss.png
      hash: md5
      md5: 42df3ec5c67323efd2426d7529c9b4a1
      size: 49767
