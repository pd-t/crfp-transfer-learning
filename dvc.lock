schema: '2.0'
stages:
  load:
    cmd: PYTHONPATH="." python3 src/load.py
    deps:
    - path: src/load.py
      hash: md5
      md5: 5058b4d14cb22b1fe1cb148f6c7e9113
      size: 1824
    params:
      params.yaml:
        data.remote.s3_bucket: data
        data.remote.s3_endpoint_url: https://storage.s3.mlops.wogra.com
        data.remote.s3_path: dlr/Tapelegedaten2023.zip
        data.seed: 42
        data.select: Complete
    outs:
    - path: data/load.dir
      hash: md5
      md5: ca839712a209e9fba6f8bd634a990aab.dir
      size: 1072939781
      nfiles: 16
  prepare:
    cmd: PYTHONPATH="." python src/prepare.py
    deps:
    - path: data/load.dir
      hash: md5
      md5: ca839712a209e9fba6f8bd634a990aab.dir
      size: 1072939781
      nfiles: 16
    - path: src/prepare.py
      hash: md5
      md5: 9f2c0de893db9cae7aee30e71d892b25
      size: 1709
    - path: src/shared/data.py
      hash: md5
      md5: dbc74e7d866940984e936c0122c5031e
      size: 1154
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    params:
      params.yaml:
        data.development-size: 0.67
        data.development-train-size: 0.9
        data.seed: 42
    outs:
    - path: data.json
      hash: md5
      md5: cfb143636dedc1a1a9f3ceb255c4f92d
      size: 95
    - path: data/prepare.dir
      hash: md5
      md5: 0e5ce2a1253560cf628b512bdd0ddfc6.dir
      size: 451747794
      nfiles: 18
  train:
    cmd: PYTHONPATH="." python src/train.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: 6e257c30aec5d0b7f3e384a81f48b837.dir
      size: 451519
      nfiles: 73
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    - path: src/train.py
      hash: md5
      md5: 872756ac76f280e671bdc52410c06481
      size: 3720
    params:
      params.yaml:
        data.seed: 42
        model.checkpoint: google/vit-base-patch16-224-in21k
        model.labels_per_category:
        - 900
        - 600
        - 300
        - 90
        - 60
        - 30
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 10
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: models.json
      hash: md5
      md5: b01cbe387604bdc07537edf79e3665be
      size: 1326
  evaluate:
    cmd: PYTHONPATH="." python src/eval.py
    deps:
    - path: data/search.dir
      hash: md5
      md5: 5d8f36b427ecbff26cf5121d3a4c3395.dir
      size: 297599
      nfiles: 45
    - path: src/eval.py
      hash: md5
      md5: 985f1f91a8660f31dc86bf75937ab6fe
      size: 3087
    outs:
    - path: accuracy.json
      hash: md5
      md5: 4be7d31ec2cde52bbf9389cd0d6b6c5e
      size: 970
    - path: loss.json
      hash: md5
      md5: eb6dc966007703a9f6aa949b22acffc2
      size: 936
    - path: metrics.json
      hash: md5
      md5: d379b637ad8b23ebb877878060219f4c
      size: 81
  search:
    cmd: PYTHONPATH="." python src/search.py
    deps:
    - path: data/prepare.dir
      hash: md5
      md5: 0e5ce2a1253560cf628b512bdd0ddfc6.dir
      size: 451747794
      nfiles: 18
    - path: src/search.py
      hash: md5
      md5: f053b99315f35a16b2484604fbb4500b
      size: 2734
    - path: src/shared/data.py
      hash: md5
      md5: dbc74e7d866940984e936c0122c5031e
      size: 1154
    - path: src/shared/helpers.py
      hash: md5
      md5: 48e563e980be7bd4ff8e91b6af67e395
      size: 210
    - path: src/shared/learning.py
      hash: md5
      md5: 407af990b24b42f13496d1e3599f864e
      size: 4497
    params:
      params.yaml:
        asha.grace_period: 3
        asha.max_t: 10
        asha.n_trials: 10
        asha.reduction_factor: 2
        asha.trial_cpus: 1
        asha.trial_gpus: 0.5
        data.seed: 42
        hyperparameters.batch_sizes:
        - 16
        - 32
        - 64
        - 128
        hyperparameters.labels_per_category: 256
        hyperparameters.learning_rates:
        - 1e-06
        - 0.0001
        model.checkpoint: google/vit-base-patch16-224-in21k
        trainer.gradient_accumulation_steps: 4
        trainer.learning_rate: 1e-05
        trainer.loading_steps: 10
        trainer.logging_steps: 10
        trainer.num_train_epochs: 10
        trainer.per_device_eval_batch_size: 128
        trainer.per_device_train_batch_size: 128
        trainer.warmup_ratio: 0.1
    outs:
    - path: data/search.dir
      hash: md5
      md5: 6e257c30aec5d0b7f3e384a81f48b837.dir
      size: 451519
      nfiles: 73
